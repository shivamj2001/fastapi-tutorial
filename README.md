# FastAPI Tutorial Project

This project is a step-by-step backend learning implementation using **FastAPI**, evolving from basic CRUD APIs to a **production-style architecture** with **async SQLAlchemy ORM**, **Alembic migrations**, and **clean separation of concerns**.

The goal of this project is to understand **how real-world FastAPI backends are structured**, not just how to make endpoints work.

---

## What This Project Demonstrates

- How to structure a FastAPI project professionally
- How to separate API, business logic, and database layers
- How to use **Pydantic schemas** for request/response validation
- How to use **SQLAlchemy ORM (2.0 style)** instead of raw SQL
- How to manage **async database sessions**
- How to manage database schema changes using **Alembic**
- How to add middleware, background tasks, and global error handling

---


config.py : application configuration (env-based)
.env      : environment variables


## Features Implemented So Far

- Full **CRUD API** for Users
- **Async SQLAlchemy ORM** with PostgreSQL
- **ORM relationships** (User ↔ Address)
- **Alembic migrations** for schema versioning
- **Async session management** using FastAPI dependency injection
- Clean **project structure** (routers, services, schemas, db, core)
- **Request & Response schema separation**
- **Service layer** for business logic
- **Request logging middleware**
- **Background audit task** (non-blocking)
- **Global error handling**
- Environment-based **configuration management**
- Legacy **raw SQL implementation preserved for reference**


## Project Structure

app/
│
├── main.py
│ └── Application entry point
│ - Creates FastAPI app
│ - Registers routers
│ - Adds middleware and global error handlers
│
├── db/
│ ├── base.py
│ │ └── SQLAlchemy declarative base
│ │ - Central registry for all ORM models
│ │
│ └── session.py
│ └── Async database engine and session lifecycle
│ - create_async_engine
│ - AsyncSessionLocal
│ - get_db dependency
│
├── models/
│ ├── user.py
│ │ └── ORM User model (users table)
│ │
│ ├── address.py
│ │ └── ORM Address model (addresses table)
│ │ - Demonstrates relationships
│ │
│ └── init.py
│ └── Imports all models so SQLAlchemy can register them
│
├── schemas/
│ ├── user_request.py
│ │ └── Request models (UserCreate, UserUpdate)
│ │
│ ├── user_response.py
│ │ └── Response models (UserResponse)
│ │
│ └── common.py
│ └── Shared schema definitions
│
├── services/
│ ├── user_service.py
│ │ └── Async ORM-based business logic (ACTIVE)
│ │
│ ├── user_service_raw.py
│ │ └── Legacy raw SQL implementation (REFERENCE ONLY)
│ │
│ └── audit_service.py
│ └── Background audit logging logic
│
├── routers/
│ ├── users.py
│ │ └── Async API routes using ORM services (ACTIVE)
│ │
│ └── users_raw.py
│ └── Legacy sync routes (REFERENCE ONLY)
│
├── core/
│ └── config.py
│ └── Application configuration using environment variables
│
├── alembic/
│ └── Database migration scripts
│
├── alembic.ini
│ └── Alembic configuration file
│
└── .env
└── Environment variables (DB credentials, app config)



## Architecture Overview

Client
↓
Router (HTTP handling)
↓
Dependency Injection (get_db)
↓
Service Layer (business logic)
↓
SQLAlchemy ORM
↓
PostgreSQL
↓
Response (Pydantic schemas)







Each layer has a **single responsibility**, making the system easier to understand, test, and extend.

---

## Database Layer Explanation

### ORM Models
- Database tables are defined using Python classes
- Relationships are defined using SQLAlchemy ORM
- No raw SQL is written in active code

### Async Session Management
- Each request gets its own `AsyncSession`
- Sessions are automatically closed after request completion
- Prevents connection leaks and blocking behavior

### Alembic Migrations
- Database schema changes are versioned
- Migrations are autogenerated from ORM models
- Supports upgrade and downgrade of schema

---

## Request Logging Middleware

A global middleware logs:
- HTTP method
- URL path
- Status code
- Time taken

Example log:
GET /users -> 200 [0.0041s]
This helps with debugging, monitoring, and auditing.

## CRUD APIs Implemented
- Operation	Endpoint
- Create user	POST /users
- Get all users	GET /users
- Get user by ID	GET /users/{id}
- Update user	PUT /users/{id}
- Delete user	DELETE /users/{id}


## Background Audit Task

- Important actions (like user creation) are logged in the background using FastAPI’s BackgroundTasks.
- Response is sent immediately
- Audit logging runs asynchronously
- Simulates DB/file/external logging

Example output:

[AUDIT] CREATE_USER | User 1 created

## Global Error Handling

- A global exception handler:
- Catches all unhandled exceptions
- Prevents stack traces from leaking
- Returns a clean error response

Example response:

{
  "success": false,
  "message": "Internal server error"
}